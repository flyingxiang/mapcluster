<%- include header %>

<script src="/javascripts/ol-debug.js"></script>
<script src="/javascripts/angular.js"></script>
<div  ng-app="myApp" ng-controller="mapCtrl">
<div class="container-fluid">
  <div class="row-fluid">
    <div class="span12">
      <div id="map" class="map"></div>
    </div>
  </div>
</div>
</div>
<script>
var map = new ol.Map({
  view: new ol.View({
    center: [0, 0],
    zoom: 1
  }),
  layers: [
    new ol.layer.Tile({
      source: new ol.source.OSM()
    })
  ],
  target: 'map'
});

var app = angular.module('myApp', []);
app.controller('mapCtrl', function($http) {
  $http.get("http://localhost:3000/features/all").success(function(res) {
    var originSource = new ol.source.Vector();
    res.forEach (function(fj) {
      var originFeature = new ol.format.GeoJSON().readFeature(fj,{
        dataProjection: 'EPSG:4326',
        featureProjection: 'EPSG:900913'
      });
      originSource.addFeature(originFeature);
    })
    var originLayer = new ol.layer.Vector({source: originSource});
    map.addLayer(originLayer);
  });
  
});

</script>

<%- include footer %>
